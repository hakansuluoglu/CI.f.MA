version: 2
jobs:

  build:
    branches:
      only:
      - beta
    docker:
    - image: circleci/android:api-28-alpha
    environment:
      JVM_OPTS: -Xmx3200m
      FASTLANE_LANE: betaWebeeSelcuk

    steps:
    - checkout

    - restore_cache:
        key: 1-gems-{{ checksum "Gemfile.lock" }}

    - run: bundle check || bundle install --path vendor/bundle

    - save_cache:
        key: 1-gems-{{ checksum "Gemfile.lock" }}
        paths:
        - vendor/bundle

    - run: echo $ENCODED_KEYSTORE | base64 --decode > keystore.jks

    - run: echo 'export KEYSTORE=${HOME}/project/keystore.jks' >> $BASH_ENV

    - run:
        name: fastlane
        command:  bundle exec fastlane $FASTLANE_LANE

    - store_artifacts:
        path: output

    - store_test_results:
        path: output/scan